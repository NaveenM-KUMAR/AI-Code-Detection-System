```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Code Detection System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient: linear-gradient(160deg, #1e1b4b 0%, #312e81 40%, #0ea5e9 100%);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.3);
            --glass-shadow: 0 24px 48px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            --accent-indigo: #6366f1;
            --accent-teal: #06b6d4;
            --text-dark: #0f172a;
            --text-muted: #64748b;
            --success: #16a34a;
            --danger: #dc2626;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            font-weight: 300;
            max-width: 720px;
            margin: 0 auto;
        }

        /* Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: var(--glass-bg);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(14px) saturate(120%);
            border: 1px solid var(--glass-border);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Input section */
        .file-upload-section {
            margin-bottom: 20px;
            padding: 24px;
            border: 2px dashed rgba(59, 130, 246, 0.45);
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.06), rgba(14, 165, 233, 0.04));
        }

        .file-upload-section:hover {
            border-color: #3b82f6;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.1), rgba(14, 165, 233, 0.08));
            transform: translateY(-2px);
            box-shadow: 0 10px 24px rgba(59, 130, 246, 0.12);
        }

        .file-upload-section.dragover {
            border-color: var(--accent-teal);
            background: linear-gradient(180deg, rgba(14, 165, 233, 0.12), rgba(99, 102, 241, 0.08));
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.18);
        }

        .file-input { display: none; }

        .file-label {
            cursor: pointer;
            color: #1d4ed8;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .file-label:hover { color: #1e40af; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.6); }

        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #334155;
        }

        .selected-file {
            margin-top: 10px;
            padding: 12px 14px;
            background: linear-gradient(90deg, #dcfce7, #bbf7d0);
            border-radius: 12px;
            border-left: 5px solid var(--success);
            color: #14532d;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            
        }

        .code-input {
            width: 100%;
            min-height: 400px;
            padding: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 16px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
            background: linear-gradient(180deg, #ffffff, #f8fafc);
        }

        .code-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12);
            transform: translateY(-1px);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(.2,.9,.2,1);
            margin-top: 20px;
            width: 100%;
            box-shadow: 0 10px 24px rgba(79, 70, 229, 0.35), 0 2px 6px rgba(0, 0, 0, 0.12);
        }

        .analyze-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 16px 36px rgba(79, 70, 229, 0.45), 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .analyze-btn:active { transform: translateY(-1px) scale(1.01); }
        .analyze-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 6px 16px rgba(79, 70, 229, 0.25);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 24px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.25);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            animation: spin 0.9s linear infinite;
            margin: 0 auto 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Results */
        .result-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
            border-radius: 18px;
            padding: 26px;
            margin-bottom: 20px;
            border-left: 6px solid var(--accent-indigo);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }

        .prediction {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 8px;
            text-align: center;
            letter-spacing: -0.5px;
        }

        .prediction.human { color: #059669; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.6); }
        .prediction.ai { color: #dc2626; text-shadow: 0 1px 0 rgba(255, 255, 255, 0.6); }

        .confidence {
            text-align: center;
            font-size: 1.15rem;
            color: #334155;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: linear-gradient(180deg, #ffffff, #f1f5f9);
            padding: 18px;
            border-radius: 14px;
            text-align: center;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.15);
        }

        .metric-value { font-size: 1.6rem; font-weight: 700; color: var(--text-dark); }
        .metric-label { font-size: 0.95rem; color: var(--text-muted); margin-top: 6px; }

        /* Horizontal sections below input */
        .horizontal-pair {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .horiz-card {
            background: linear-gradient(180deg, #f8fafc, #e2e8f0);
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(148, 163, 184, 0.15);
        }

        .horiz-card h5 {
            color: var(--text-dark);
            font-size: 1.02rem;
            margin: 0 0 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .horiz-card ul { list-style: none; padding: 0; margin: 0; }
        .horiz-card li {
            background: linear-gradient(90deg, #ffffff, #f1f5f9);
            margin: 8px;
            padding: 10px 12px;
            border-radius: 10px;
            border-left: 4px solid var(--accent-indigo);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        }
        .horiz-card li:hover { transform: translateX(4px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.12); }
        .horiz-card li strong { color: var(--text-dark); font-weight: 700; }
        .horiz-card li span { color: #334155; font-weight: 600; }

        /* Insights (remaining) */
        .insights-section {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
            border-radius: 14px;
            padding: 22px;
            margin-top: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.15);
        }

        .insights-section h4 {
            color: var(--text-dark);
            font-size: 1.15rem;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .insights-section h5 {
            color: #1e293b;
            font-size: 1.02rem;
            margin: 20px 0 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .insights-section ul { list-style: none; padding: 0; margin: 0; }
        .insights-section li {
            background: linear-gradient(90deg, #f8fafc, #e2e8f0);
            margin: 8px;
            padding: 12px 16px;
            border-radius: 12px;
            border-left: 4px solid var(--accent-indigo);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.96rem;
            transition: all 0.2s ease;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        }
        .insights-section li:hover { transform: translateX(6px); box-shadow: 0 4px 14px rgba(99, 102, 241, 0.12); }
        .insights-section li strong { color: var(--text-dark); font-weight: 700; }
        .insights-section li span { color: #334155; font-weight: 600; }

        .insights-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, #cbd5e1 50%, transparent 100%);
            margin: 24px 0;
        }

        .insights-card {
            background: linear-gradient(180deg, #f8fafc, #e2e8f0);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 6px 18px rgba(99, 102, 241, 0.08);
        }

        .insights-card h5 {
            color: var(--text-dark);
            margin-bottom: 16px;
            font-size: 1.02rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-highlight {
            background: linear-gradient(90deg, var(--accent-indigo), #8b5cf6);
            color: white;
            padding: 8px 16px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.35);
        }

        .performance-info {
            background: linear-gradient(90deg, #dcfce7, #bbf7d0);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            border-left: 5px solid var(--success);
            box-shadow: 0 6px 16px rgba(22, 163, 74, 0.12);
        }

        .performance-item { display: flex; justify-content: space-between; margin-bottom: 6px; font-weight: 600; }

        .error-message {
            background: linear-gradient(90deg, #fee2e2, #fecaca);
            color: #7f1d1d;
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            border-left: 5px solid var(--danger);
            box-shadow: 0 6px 18px rgba(220, 38, 38, 0.12);
        }

        .success-message {
            background: linear-gradient(90deg, #dcfce7, #bbf7d0);
            color: #14532d;
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            border-left: 5px solid var(--success);
            box-shadow: 0 6px 18px rgba(22, 163, 74, 0.12);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 1rem;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            margin-left: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
            background: linear-gradient(90deg, #94a3b8, #64748b);
        }
        .badge:hover { transform: scale(1.08) rotate(-2deg); box-shadow: 0 8px 20px rgba(0,0,0,0.18); }
        .badge-good { background: linear-gradient(90deg, #10b981, #34d399); color: #064e3b; }
        .badge-average { background: linear-gradient(90deg, #f59e0b, #fbbf24); color: #78350f; }
        .badge-poor { background: linear-gradient(90deg, #ef4444, #f87171); color: #7f1d1d; }
        .badge-high { background: linear-gradient(90deg, #ef4444, #fb7185); color: #7f1d1d; }
        .badge-medium { background: linear-gradient(90deg, #a855f7, #c084fc); color: #4c1d95; }
        .badge-low { background: linear-gradient(90deg, #06b6d4, #22d3ee); color: #083344; }

        .styled-summary {
            background: linear-gradient(90deg, #f1f5f9, #e2e8f0);
            border-radius: 18px;
            box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
            padding: 18px 24px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 1.1rem;
            border: 1.5px solid rgba(148, 163, 184, 0.25);
            animation: popIn 0.5s cubic-bezier(.68,-0.55,.27,1.55);
        }

        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 1100px) {
            .main-layout { grid-template-columns: 1fr; }
            .header h1 { font-size: 2.2rem; }
            .horizontal-pair { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- HEADER -->
        <div class="header">
            <h1><i class="fas fa-brain"></i> AI Code Detection System</h1>
            <p>Advanced code analysis using AI-powered heuristics and feature extraction</p>
        </div>

        <div class="main-layout">

            <!-- LEFT: INPUT -->
            <div class="panel input-section">

                <div class="section-title">
                    <i class="fas fa-code"></i> Upload Code or Paste Snippet
                </div>

                <div class="file-upload-section" id="fileUploadSection">
                    <input type="file" id="fileInput" class="file-input"
                           accept=".txt,.py,.js,.java,.cpp,.c,.cs,.php,.rb,.go,.rs,.swift,.kt,.scala,.html,.css,.xml,.json,.sql,.sh,.bat,.ps1,.md,.pdf,.zip,.rar,.7z">

                    <label for="fileInput" class="file-label">
                        <i class="fas fa-cloud-upload-alt fa-2x"></i><br><br>
                        <strong>Select a file</strong> or drag & drop
                    </label>

                    <div class="file-info">
                        Supported: Code files, PDFs, Archives (ZIP/RAR/7Z)<br>
                        Max size: 50MB
                    </div>
                </div>

                <div id="selectedFileInfo" class="selected-file" style="display:none;">
                    <strong>Selected file:</strong> <span id="fileName"></span>
                    <button onclick="clearFile()" style="margin-left:10px;padding:2px 10px;background:#dc2626;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:700;">√ó</button>
                </div>

                <textarea id="codeInput" class="code-input" placeholder="Or paste your code snippet here..." spellcheck="false"></textarea>

                <!-- STYLE + COMPLEXITY -->
                <div class="horizontal-pair">

                    <div class="horiz-card">
                        <h5><i class="fas fa-palette"></i> Code Style Report</h5>
                        <ul id="styleList"></ul>
                    </div>

                    <div class="horiz-card">
                        <h5><i class="fas fa-chart-line"></i> Complexity Breakdown</h5>
                        <ul id="complexityList"></ul>
                    </div>

                </div>

                <button id="analyzeBtn" class="analyze-btn">
                    <i class="fas fa-search"></i> Analyze Code
                </button>

                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing code using AI-powered feature extraction...</p>
                </div>

            </div>

            <!-- RIGHT: RESULTS -->
            <div class="panel results-section">

                <div class="section-title">
                    <i class="fas fa-chart-bar"></i> Classification Results
                </div>

                <div id="results" style="display:none;">

                    <div class="result-card">

                        <div id="prediction" class="prediction"></div>
                        <div id="confidence" class="confidence"></div>

                        <div class="metrics-grid">

                            <div class="metric-card">
                                <div id="aiProb" class="metric-value"></div>
                                <div class="metric-label">AI-Generated Probability</div>
                            </div>

                            <div class="metric-card">
                                <div id="humanProb" class="metric-value"></div>
                                <div class="metric-label">Human-Written Probability</div>
                            </div>

                            <div class="metric-card">
                                <div id="featuresUsed" class="metric-value"></div>
                                <div class="metric-label">Features Used</div>
                            </div>

                            <div class="metric-card">
                                <div id="neuralFeatures" class="metric-value"></div>
                                <div class="metric-label">Extracted Patterns</div>
                            </div>

                        </div>

                        <div id="performanceInfo" class="performance-info" style="display:none;">
                            <h4><i class="fas fa-tachometer-alt"></i> Code Quality Metrics</h4>
                            <div id="performanceDetails"></div>
                        </div>

                        <div id="fileInfo" class="performance-info" style="display:none;">
                            <h4><i class="fas fa-file"></i> File Information</h4>
                            <div id="fileDetails"></div>
                        </div>

                    </div>

                    <div class="insights-section">
                        <h4><i class="fas fa-lightbulb"></i> Detailed Insights</h4>
                        <div id="insights"></div>
                    </div>

                </div>

                <div id="errorMessage" class="error-message" style="display:none;"></div>
                <div id="successMessage" class="success-message" style="display:none;"></div>

            </div>

        </div>

    </div>

    <script>
        let selectedFile = null;
        let analysisData = null;

        // File handling
        document.getElementById('fileInput').addEventListener('change', function(e){
            const file = e.target.files[0];
            if(file){
                selectedFile = file;
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('selectedFileInfo').style.display = 'flex';
                document.getElementById('codeInput').value = '';
                showMessage(`File "${file.name}" selected successfully!`, 'success');
            }
        });

        const fileUploadSection = document.getElementById('fileUploadSection');
        fileUploadSection.addEventListener('dragover', function(e){ e.preventDefault(); fileUploadSection.classList.add('dragover'); });
        fileUploadSection.addEventListener('dragleave', function(e){ e.preventDefault(); fileUploadSection.classList.remove('dragover'); });
        fileUploadSection.addEventListener('drop', function(e){
            e.preventDefault(); fileUploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if(files.length > 0){
                const file = files[0];
                if(isValidFileType(file.name)){
                    selectedFile = file;
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('selectedFileInfo').style.display = 'flex';
                    document.getElementById('codeInput').value = '';
                    showMessage(`File "${file.name}" uploaded successfully!`, 'success');
                } else {
                    showMessage('Invalid file type. Please upload a supported file.', 'error');
                }
            }
        });

        function clearFile(){ selectedFile = null; document.getElementById('fileInput').value=''; document.getElementById('selectedFileInfo').style.display='none'; document.getElementById('codeInput').focus(); }
        function isValidFileType(filename){ const exts=['txt','py','js','java','cpp','c','cs','php','rb','go','rs','swift','kt','scala','html','css','xml','json','sql','sh','bat','ps1','md','pdf','zip','rar','7z']; return exts.includes(filename.split('.').pop().toLowerCase()); }

        // Analyze
        document.getElementById('analyzeBtn').addEventListener('click', function(){
            const code = document.getElementById('codeInput').value.trim();
            if(!selectedFile && !code){ showMessage('Please upload a file or paste code to analyze.', 'error'); return; }
            showLoading(true); hideMessages();
            if(selectedFile) uploadAndAnalyzeFile(selectedFile); else analyzeCode(code);
        });

        function uploadAndAnalyzeFile(file){
            const fd = new FormData(); fd.append('file', file);
            fetch('/upload',{method:'POST',body:fd}).then(r=>r.json()).then(data=>{
                showLoading(false);
                if(data.error) showMessage(data.error,'error'); else { analysisData = data; displayResults(data); updateHorizontalSections(); }
            }).catch(err=>{ showLoading(false); showMessage('Error uploading file: '+err.message,'error'); });
        }
        function analyzeCode(code){
            fetch('/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})}).then(r=>r.json()).then(data=>{
                showLoading(false);
                if(data.error) showMessage(data.error,'error'); else { analysisData = data; displayResults(data); updateHorizontalSections(); }
            }).catch(err=>{ showLoading(false); showMessage('Error analyzing code: '+err.message,'error'); });
        }

        function displayResults(data){
            const results = document.getElementById('results'), pred = document.getElementById('prediction'), conf = document.getElementById('confidence'),
                  aiP = document.getElementById('aiProb'), huP = document.getElementById('humanProb'), fUsed = document.getElementById('featuresUsed'), nFeat = document.getElementById('neuralFeatures'),
                  insights = document.getElementById('insights'), perfInfo = document.getElementById('performanceInfo'), perfDet = document.getElementById('performanceDetails'),
                  fileInfo = document.getElementById('fileInfo'), fileDet = document.getElementById('fileDetails');

            pred.textContent = data.prediction; pred.className = 'prediction ' + data.prediction.toLowerCase();
            conf.textContent = `Confidence: ${(data.confidence*100).toFixed(1)}%`;
            aiP.textContent = `${(data.ai_probability*100).toFixed(1)}%`; huP.textContent = `${(data.human_probability*100).toFixed(1)}%`;
            fUsed.textContent = data.features_used; nFeat.textContent = data.neural_features;

            // Populate horizontal cards (style & complexity)
            const styleList = document.getElementById('styleList'), compList = document.getElementById('complexityList');
            styleList.innerHTML = ''; compList.innerHTML = '';
            if(data.style){
                const items = [
                    ['Indentation', data.style.indentation_consistency || 'N/A'],
                    ['Comment Ratio', data.style.comment_ratio != null ? (data.style.comment_ratio*100).toFixed(1)+'%' : 'N/A'],
                    ['Line Length Variation', data.style.line_length_variation != null ? data.style.line_length_variation.toFixed(2) : 'N/A'],
                    ['Dominant Naming', data.style.naming_conventions && data.style.naming_conventions.dominant ? data.style.naming_conventions.dominant : 'N/A']
                ];
                items.forEach(([k,v])=>{ const li=document.createElement('li'); li.innerHTML=`<strong>${k}:</strong><span>${v}</span>`; styleList.appendChild(li); });
            } else {
                const li=document.createElement('li'); li.innerHTML='<strong>No style data</strong><span>N/A</span>'; styleList.appendChild(li);
            }
            if(data.complexity){
                const items = [
                    ['Functions', data.complexity.functions ?? 'N/A'],
                    ['Classes', data.complexity.classes ?? 'N/A'],
                    ['Imports', data.complexity.imports ?? 'N/A'],
                    ['Function Calls', data.complexity.function_calls ?? 'N/A'],
                    ['Assignments', data.complexity.assignments ?? 'N/A'],
                    ['Loops', data.complexity.loops ?? 'N/A'],
                    ['Conditionals', data.complexity.conditionals ?? 'N/A'],
                    ['Exceptions', data.complexity.exceptions ?? 'N/A']
                ];
                items.forEach(([k,v])=>{ const li=document.createElement('li'); li.innerHTML=`<strong>${k}:</strong><span>${v}</span>`; compList.appendChild(li); });
            } else {
                const li=document.createElement('li'); li.innerHTML='<strong>No complexity data</strong><span>N/A</span>'; compList.appendChild(li);
            }

            // Remaining insights (overview, etc.)
            insights.innerHTML = `
                <div class="insights-card">
                    <h5><i class="fas fa-cog" style="color:#6366f1"></i> Analysis Overview</h5>
                    <ul>
                        <li><strong>Model Type:</strong> <span class="metric-highlight">${data.model_type}</span></li>
                        <li><strong>Language:</strong> <span class="metric-highlight">${data.language}</span></li>
                        <li><strong>Status:</strong> <span>${data.message}</span></li>
                    </ul>
                </div>
            `;

            // Performance (style/complexity rating badges)
            perfInfo.style.display = 'block';
            let styleBadge='', compBadge='';
            if(data.style){
                if(data.style.indentation_consistency==='Consistent' && data.style.comment_ratio>0.1){ styleBadge='<span class="badge badge-good">üå± Good</span>'; }
                else if(data.style.indentation_consistency==='Mostly consistent' || data.style.comment_ratio>0.05){ styleBadge='<span class="badge badge-average">üçã Average</span>'; }
                else { styleBadge='<span class="badge badge-poor">üçÇ Poor</span>'; }
            }
            if(data.complexity){
                const total = (data.complexity.functions||0)+(data.complexity.classes||0)+(data.complexity.conditionals||0);
                if(total>10){ compBadge='<span class="badge badge-high">üî• High</span>'; }
                else if(total>3){ compBadge='<span class="badge badge-medium">‚ö° Medium</span>'; }
                else { compBadge='<span class="badge badge-low">üçÉ Low</span>'; }
            }
            perfDet.innerHTML = `<div class="performance-item styled-summary"><span><strong>Code Style Rate:</strong></span><span>${styleBadge||''}</span></div>
                                 <div class="performance-item styled-summary"><span><strong>Complexity Rate:</strong></span><span>${compBadge||''}</span></div>`;

            // File info
            if(data.file_info){ fileInfo.style.display='block'; fileDet.innerHTML = `<div class="performance-item"><span>Filename:</span><span>${data.file_info.filename}</span></div>
                <div class="performance-item"><span>Size:</span><span>${(data.file_info.size/1024).toFixed(1)} KB</span></div>
                <div class="performance-item"><span>Type:</span><span>${data.file_info.type}</span></div>`; } else { fileInfo.style.display='none'; }

            results.style.display='block'; showMessage('Analysis completed successfully!','success');
        }

        function updateHorizontalSections() {
            if (!analysisData) return;
            const styleList = document.getElementById('styleList');
            const compList = document.getElementById('complexityList');
            styleList.innerHTML = ''; compList.innerHTML = '';
            if(analysisData.style){
                const items = [
                    ['Indentation', analysisData.style.indentation_consistency || 'N/A'],
                    ['Comment Ratio', analysisData.style.comment_ratio != null ? (analysisData.style.comment_ratio*100).toFixed(1)+'%' : 'N/A'],
                    ['Line Length Variation', analysisData.style.line_length_variation != null ? analysisData.style.line_length_variation.toFixed(2) : 'N/A'],
                    ['Dominant Naming', analysisData.style.naming_conventions && analysisData.style.naming_conventions.dominant ? analysisData.style.naming_conventions.dominant : 'N/A']
                ];
                items.forEach(([k,v])=>{ const li=document.createElement('li'); li.innerHTML=`<strong>${k}:</strong><span>${v}</span>`; styleList.appendChild(li); });
            } else {
                const li=document.createElement('li'); li.innerHTML='<strong>No style data</strong><span>N/A</span>'; styleList.appendChild(li);
            }
            if(analysisData.complexity){
                const items = [
                    ['Functions', analysisData.complexity.functions ?? 'N/A'],
                    ['Classes', analysisData.complexity.classes ?? 'N/A'],
                    ['Imports', analysisData.complexity.imports ?? 'N/A'],
                    ['Function Calls', analysisData.complexity.function_calls ?? 'N/A'],
                    ['Assignments', analysisData.complexity.assignments ?? 'N/A'],
                    ['Loops', analysisData.complexity.loops ?? 'N/A'],
                    ['Conditionals', analysisData.complexity.conditionals ?? 'N/A'],
                    ['Exceptions', analysisData.complexity.exceptions ?? 'N/A']
                ];
                items.forEach(([k,v])=>{ const li=document.createElement('li'); li.innerHTML=`<strong>${k}:</strong><span>${v}</span>`; compList.appendChild(li); });
            } else {
                const li=document.createElement('li'); li.innerHTML='<strong>No complexity data</strong><span>N/A</span>'; compList.appendChild(li);
            }
        }

        function showLoading(show){ const loading=document.getElementById('loading'), btn=document.getElementById('analyzeBtn'); if(show){ loading.style.display='block'; btn.disabled=true; btn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Analyzing...'; } else { loading.style.display='none'; btn.disabled=false; btn.innerHTML='<i class="fas fa-search"></i> Analyze Code'; } }
        function showMessage(msg,type){ const err=document.getElementById('errorMessage'), suc=document.getElementById('successMessage'); if(type==='error'){ err.textContent=msg; err.style.display='block'; suc.style.display='none'; } else { suc.textContent=msg; suc.style.display='block'; err.style.display='none'; } }
        function hideMessages(){ document.getElementById('errorMessage').style.display='none'; document.getElementById('successMessage').style.display='none'; }
    </script>
</body>
</html>